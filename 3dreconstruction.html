<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="author" content="Sigit Ari Wijanarko, Hendy Irawan" />


<title>2D to 3D Reconstruction for Virtual Perception</title>

<script src="3dreconstruction_files/jquery-1.11.0/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="3dreconstruction_files/bootstrap-3.3.1/css/bootstrap.min.css" rel="stylesheet" />
<script src="3dreconstruction_files/bootstrap-3.3.1/js/bootstrap.min.js"></script>
<script src="3dreconstruction_files/bootstrap-3.3.1/shim/html5shiv.min.js"></script>
<script src="3dreconstruction_files/bootstrap-3.3.1/shim/respond.min.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<link rel="stylesheet"
      href="3dreconstruction_files/highlight/default.css"
      type="text/css" />
<script src="3dreconstruction_files/highlight/highlight.js"></script>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs && document.readyState && document.readyState === "complete") {
   window.setTimeout(function() {
      hljs.initHighlighting();
   }, 0);
}
</script>



</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img { 
  max-width:100%; 
  height: auto; 
}
</style>
<div class="container-fluid main-container">


<div id="header">
<h1 class="title">2D to 3D Reconstruction for Virtual Perception</h1>
<h4 class="author"><em>Sigit Ari Wijanarko, Hendy Irawan</em></h4>
<h4 class="date"><em>Saturday, April 04, 2015</em></h4>
</div>


<div id="units-coordinate-system" class="section level2">
<h2>Units &amp; Coordinate System</h2>
<p>Lihat: <a href="coordinates.html">Lumen Units and 2D/3D Coordinate System</a></p>
</div>
<div id="d-reconstruction" class="section level2">
<h2>3D Reconstruction</h2>
<p>Formula: <a href="http://docs.opencv.org/modules/calib3d/doc/camera_calibration_and_3d_reconstruction.html" class="uri">http://docs.opencv.org/modules/calib3d/doc/camera_calibration_and_3d_reconstruction.html</a></p>
<pre><code>s * UV = CM * Rt * XYZ</code></pre>
<p>s adalah pembagi dari UV, bila UV = (20, 10, 2) maka u = 20/2 = 10, v = 10/2 = 5.</p>
<p><span class="math">\[\mathbf{CM} = \left[\begin{array}
{rrr}
f_x &amp;    0 &amp; c_x \\
  0 &amp; -f_y &amp; c_y \\
  0 &amp;    0 &amp;   1
\end{array}\right]
\]</span></p>
<p><span class="math">\(-f_y\)</span> diminuskan karena di gambar 2D, pojok atas adalah <span class="math">\(v=0\)</span> dan bawah adalah misalnya <span class="math">\(v=240\)</span> (untuk dimensi 320Ã240); padahal di 3D bawah adalah <span class="math">\(y&lt;0\)</span> dan atas adalah <span class="math">\(y&gt;0\)</span>.</p>
<p>Untuk mendapatkan <span class="math">\(f_x\)</span> dan <span class="math">\(f_y\)</span>, kita menentukan dulu focal length dan ukuran “sensor”. Anggap focal length (<span class="math">\(F\)</span>) 35mm. Dan sensor 36mm x 24mm (Full-frame). Trus resolusi gambar 320Ã240.</p>
<ul>
<li><span class="math">\(s_x\)</span> = image width(px) / sensor width(mm) = 320px / 36mm = 8.9px/mm</li>
<li><span class="math">\(s_y\)</span> = image height(px) / sensor height(mm) = 240px / 24mm = 10px/mm</li>
<li>kalo square pixel, harusnya <span class="math">\(s_x = s_y\)</span></li>
</ul>
<p>Maka</p>
<ul>
<li><span class="math">\(f_x\)</span> = F * sx = 35mm * 8.9 = 311.1 px</li>
<li><span class="math">\(f_y\)</span> = F * sy = 35mm * 10 = 350 px</li>
<li><span class="math">\(c_x\)</span> (image horizontal center) = imageWidth / 2</li>
<li><span class="math">\(c_y\)</span> (image vertical center) = imageHeight / 2</li>
</ul>
<p>Maka</p>
<pre class="r"><code>library(pander)
# 35mm lens on Sony Alpha 7r
focalLength &lt;- 35 #mm
imageWidth &lt;- 320 #px
imageHeight &lt;- 240 #Px
sensorWidth &lt;- 36 #mm
sensorHeight &lt;- 24 #mm
centerX &lt;- imageWidth / 2 #px
centerY &lt;- imageHeight / 2 #px
CM &lt;- matrix(c(focalLength * imageWidth / sensorWidth, 0, centerX,
               0, -focalLength * imageHeight / sensorHeight, centerY,
               0, 0, 1), ncol=3, byrow=TRUE)
pander(CM, caption=&#39;camera matrix&#39;)</code></pre>
<table>
<caption>camera matrix</caption>
<colgroup>
<col width="8%" />
<col width="6%" />
<col width="6%" />
</colgroup>
<tbody>
<tr class="odd">
<td align="left">311.1</td>
<td align="center">0</td>
<td align="left">160</td>
</tr>
<tr class="even">
<td align="left">0</td>
<td align="center">-350</td>
<td align="left">120</td>
</tr>
<tr class="odd">
<td align="left">0</td>
<td align="center">0</td>
<td align="left">1</td>
</tr>
</tbody>
</table>
<p>Contoh: Samsung Galaxy S4:</p>
<ul>
<li>Aperture size F2.2</li>
<li>Focal length (35mm equivalent): 31 mm –&gt; harus dikonversi ke focal length fisik = 4.3mm (<a href="http://www.digified.net/focallength/" class="uri">http://www.digified.net/focallength/</a>)</li>
<li>Camera sensor size: 1/3.06&quot; (diagonal: 0.3268&quot; = 8.3mm, dimensi: 6.64mm x 4.98mm)</li>
<li>Pixel size: 1.14 Î¼m</li>
</ul>
<pre class="r"><code># Samsung Galaxy S4
focalLength &lt;- 4.3 #mm
imageWidth &lt;- 320 #px
imageHeight &lt;- 240 #px
sensorWidth &lt;- 6.64 #mm
sensorHeight &lt;- 4.98 #mm
center &lt;- c(imageWidth / 2, imageHeight / 2) #px
names(center) &lt;- c(&#39;u&#39;, &#39;v&#39;)
f &lt;- c(focalLength * imageWidth / sensorWidth, focalLength * imageHeight / sensorHeight)
names(f) &lt;- c(&#39;x&#39;, &#39;y&#39;)
pander(f)</code></pre>
<p><em>207.2</em> and <em>207.2</em></p>
<pre class="r"><code>all.equal(f[&#39;x&#39;], f[&#39;y&#39;], check.names=FALSE) # harusnya f[&#39;x&#39;] ~ f[&#39;y&#39;] yaaa!!</code></pre>
<pre><code>## [1] TRUE</code></pre>
<pre class="r"><code>CM &lt;- matrix(c(f[&#39;x&#39;],       0, center[&#39;u&#39;],
                    0, -f[&#39;y&#39;], center[&#39;v&#39;],
                    0,       0,           1),
             ncol=3, byrow=TRUE)
pander(CM, caption=&#39;camera matrix&#39;)</code></pre>
<table>
<caption>camera matrix</caption>
<colgroup>
<col width="8%" />
<col width="9%" />
<col width="4%" />
</colgroup>
<tbody>
<tr class="odd">
<td align="left">207.2</td>
<td align="center">0</td>
<td align="left">160</td>
</tr>
<tr class="even">
<td align="left">0</td>
<td align="center">-207.2</td>
<td align="left">120</td>
</tr>
<tr class="odd">
<td align="left">0</td>
<td align="center">0</td>
<td align="left">1</td>
</tr>
</tbody>
</table>
<p>Kalau udah punya CM maka perlu bikin joint rotation-translation matrix. Ini Hendy agak bingung jadi biarin Sigit aja yang pusing :p</p>
<pre class="r"><code>theta &lt;- 0*pi # harusnya ini gamma, lihat penjelasan di bawah tentang rotasi 3D
t &lt;- c(0, 0, 0)
names(t) &lt;- c(&#39;x&#39;, &#39;y&#39;, &#39;z&#39;)
pander(t)</code></pre>
<p><em>0</em>, <em>0</em> and <em>0</em></p>
<pre class="r"><code># rotasi ini sebenarnya masih RZ, belum R
Rt &lt;- matrix(c(cos(theta), -sin(theta), 0, t[&#39;x&#39;],
               sin(theta),  cos(theta), 0, t[&#39;y&#39;],
               0,           0,          1, t[&#39;z&#39;]),
             ncol=4, byrow=TRUE)
pander(Rt)</code></pre>
<table>
<colgroup>
<col width="2%" />
<col width="2%" />
<col width="2%" />
<col width="2%" />
</colgroup>
<tbody>
<tr class="odd">
<td align="left">1</td>
<td align="left">0</td>
<td align="left">0</td>
<td align="left">0</td>
</tr>
<tr class="even">
<td align="left">0</td>
<td align="left">1</td>
<td align="left">0</td>
<td align="left">0</td>
</tr>
<tr class="odd">
<td align="left">0</td>
<td align="left">0</td>
<td align="left">1</td>
<td align="left">0</td>
</tr>
</tbody>
</table>
<p>Dari sini kita bisa memproyeksikan sebuah titik 3D ke 2D. Kalau benar, maka untuk dari 2D ke 3D ya tinggal dibalik.</p>
<pre class="r"><code>                # x    y    z   1
XYZ &lt;- matrix(c(  0,   0,0.01,  1, # persis di tengah
                  0,   0,   1,  1, # persis di tengah, agak ke depan
                 -1,   0,   1,  1, # depan, agak ke kiri
                  3,   0,   1,  1, # depan, lebih ke kanan
                  0,   1,   1,  1, # depan, atas
                  0,  -3,   1,  1, # depan, lebih ke bawah
                 -1,  -3,   1,  1, # depan, kiri atas
                  2,   4,   1,  1, # depan, kanan atas
                  0,   0,   5,  1, # persis di tengah, depan banget
                 -1,   0,   5,  1, # depan banget, agak ke kiri
                  3,   0,   5,  1, # depan banget, lebih ke kanan
                  0,   1,   5,  1, # depan banget, atas
                  0,  -3,   5,  1, # depan banget, lebih ke bawah
                 -1,  -3,   5,  1, # depan banget, kiri atas
                  2,   4,   5,  1),# depan banget, kanan atas
              ncol=4, byrow=TRUE)
colnames(XYZ) &lt;- c(&#39;x&#39;, &#39;y&#39;, &#39;z&#39;, &#39;1&#39;)
pander(XYZ)</code></pre>
<table>
<colgroup>
<col width="5%" />
<col width="5%" />
<col width="6%" />
<col width="6%" />
</colgroup>
<thead>
<tr class="header">
<th align="center">x</th>
<th align="center">y</th>
<th align="center">z</th>
<th align="center">1</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">0</td>
<td align="center">0</td>
<td align="center">0.01</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">0</td>
<td align="center">0</td>
<td align="center">1</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">-1</td>
<td align="center">0</td>
<td align="center">1</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">3</td>
<td align="center">0</td>
<td align="center">1</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">0</td>
<td align="center">1</td>
<td align="center">1</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">0</td>
<td align="center">-3</td>
<td align="center">1</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">-1</td>
<td align="center">-3</td>
<td align="center">1</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">2</td>
<td align="center">4</td>
<td align="center">1</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">0</td>
<td align="center">0</td>
<td align="center">5</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">-1</td>
<td align="center">0</td>
<td align="center">5</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">3</td>
<td align="center">0</td>
<td align="center">5</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">0</td>
<td align="center">1</td>
<td align="center">5</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">0</td>
<td align="center">-3</td>
<td align="center">5</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">-1</td>
<td align="center">-3</td>
<td align="center">5</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">2</td>
<td align="center">4</td>
<td align="center">5</td>
<td align="center">1</td>
</tr>
</tbody>
</table>
<p>Tinggal dikalikan dech:</p>
<pre class="r"><code>sUV &lt;- t(CM %*% Rt %*% XYZ[4,]) # point ke-4
names(sUV) &lt;- c(&#39;u&#39;, &#39;v&#39;, &#39;s&#39;)
pander(sUV)</code></pre>
<table>
<tbody>
<tr class="odd">
<td align="left">781.7</td>
<td align="left">120</td>
<td align="left">1</td>
</tr>
</tbody>
</table>
<pre class="r"><code>if (sUV[&#39;s&#39;] != 0) UV &lt;- sUV / sUV[&#39;s&#39;] else UV &lt;- sUV
pander(UV)</code></pre>
<table>
<tbody>
<tr class="odd">
<td align="left">781.7</td>
<td align="left">120</td>
<td align="left">1</td>
</tr>
</tbody>
</table>
<p>Atau ramean:</p>
<pre class="r"><code>sUV &lt;- t(CM %*% Rt %*% t(XYZ))
colnames(sUV) &lt;- c(&#39;su&#39;, &#39;sv&#39;, &#39;s&#39;)
pander(sUV)</code></pre>
<table>
<colgroup>
<col width="9%" />
<col width="9%" />
<col width="5%" />
</colgroup>
<thead>
<tr class="header">
<th align="center">su</th>
<th align="center">sv</th>
<th align="center">s</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">1.6</td>
<td align="center">1.2</td>
<td align="center">0.01</td>
</tr>
<tr class="even">
<td align="center">160</td>
<td align="center">120</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">-47.23</td>
<td align="center">120</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">781.7</td>
<td align="center">120</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">160</td>
<td align="center">-87.23</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">160</td>
<td align="center">741.7</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">-47.23</td>
<td align="center">741.7</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">574.5</td>
<td align="center">-708.9</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">800</td>
<td align="center">600</td>
<td align="center">5</td>
</tr>
<tr class="even">
<td align="center">592.8</td>
<td align="center">600</td>
<td align="center">5</td>
</tr>
<tr class="odd">
<td align="center">1422</td>
<td align="center">600</td>
<td align="center">5</td>
</tr>
<tr class="even">
<td align="center">800</td>
<td align="center">392.8</td>
<td align="center">5</td>
</tr>
<tr class="odd">
<td align="center">800</td>
<td align="center">1222</td>
<td align="center">5</td>
</tr>
<tr class="even">
<td align="center">592.8</td>
<td align="center">1222</td>
<td align="center">5</td>
</tr>
<tr class="odd">
<td align="center">1214</td>
<td align="center">-228.9</td>
<td align="center">5</td>
</tr>
</tbody>
</table>
<pre class="r"><code>UV &lt;- matrix(ncol = 3, nrow = nrow(sUV))
colnames(UV) &lt;- c(&#39;u&#39;, &#39;v&#39;, &#39;s&#39;)
UV[,&#39;u&#39;] &lt;- sUV[,&#39;su&#39;] / sUV[,&#39;s&#39;]
UV[,&#39;v&#39;] &lt;- sUV[,&#39;sv&#39;] / sUV[,&#39;s&#39;]
UV[,&#39;s&#39;] &lt;- sUV[,&#39;s&#39;]
pander(UV)</code></pre>
<table>
<colgroup>
<col width="9%" />
<col width="9%" />
<col width="5%" />
</colgroup>
<thead>
<tr class="header">
<th align="center">u</th>
<th align="center">v</th>
<th align="center">s</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">160</td>
<td align="center">120</td>
<td align="center">0.01</td>
</tr>
<tr class="even">
<td align="center">160</td>
<td align="center">120</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">-47.23</td>
<td align="center">120</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">781.7</td>
<td align="center">120</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">160</td>
<td align="center">-87.23</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">160</td>
<td align="center">741.7</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">-47.23</td>
<td align="center">741.7</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">574.5</td>
<td align="center">-708.9</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">160</td>
<td align="center">120</td>
<td align="center">5</td>
</tr>
<tr class="even">
<td align="center">118.6</td>
<td align="center">120</td>
<td align="center">5</td>
</tr>
<tr class="odd">
<td align="center">284.3</td>
<td align="center">120</td>
<td align="center">5</td>
</tr>
<tr class="even">
<td align="center">160</td>
<td align="center">78.55</td>
<td align="center">5</td>
</tr>
<tr class="odd">
<td align="center">160</td>
<td align="center">244.3</td>
<td align="center">5</td>
</tr>
<tr class="even">
<td align="center">118.6</td>
<td align="center">244.3</td>
<td align="center">5</td>
</tr>
<tr class="odd">
<td align="center">242.9</td>
<td align="center">-45.78</td>
<td align="center">5</td>
</tr>
</tbody>
</table>
<p>Yuk coba kita plot.</p>
<pre class="r"><code>library(ggplot2)
df &lt;- data.frame(UV)
df$id &lt;- rownames(df)
df$salpha &lt;- min(max(df$s/5, 0), 1)
df$dsize &lt;- pmin(10/df$s, 20)
pander(df)</code></pre>
<table>
<colgroup>
<col width="9%" />
<col width="9%" />
<col width="6%" />
<col width="6%" />
<col width="12%" />
<col width="12%" />
</colgroup>
<thead>
<tr class="header">
<th align="center">u</th>
<th align="center">v</th>
<th align="center">s</th>
<th align="center">id</th>
<th align="center">salpha</th>
<th align="center">dsize</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">160</td>
<td align="center">120</td>
<td align="center">0.01</td>
<td align="center">1</td>
<td align="center">1</td>
<td align="center">20</td>
</tr>
<tr class="even">
<td align="center">160</td>
<td align="center">120</td>
<td align="center">1</td>
<td align="center">2</td>
<td align="center">1</td>
<td align="center">10</td>
</tr>
<tr class="odd">
<td align="center">-47.23</td>
<td align="center">120</td>
<td align="center">1</td>
<td align="center">3</td>
<td align="center">1</td>
<td align="center">10</td>
</tr>
<tr class="even">
<td align="center">781.7</td>
<td align="center">120</td>
<td align="center">1</td>
<td align="center">4</td>
<td align="center">1</td>
<td align="center">10</td>
</tr>
<tr class="odd">
<td align="center">160</td>
<td align="center">-87.23</td>
<td align="center">1</td>
<td align="center">5</td>
<td align="center">1</td>
<td align="center">10</td>
</tr>
<tr class="even">
<td align="center">160</td>
<td align="center">741.7</td>
<td align="center">1</td>
<td align="center">6</td>
<td align="center">1</td>
<td align="center">10</td>
</tr>
<tr class="odd">
<td align="center">-47.23</td>
<td align="center">741.7</td>
<td align="center">1</td>
<td align="center">7</td>
<td align="center">1</td>
<td align="center">10</td>
</tr>
<tr class="even">
<td align="center">574.5</td>
<td align="center">-708.9</td>
<td align="center">1</td>
<td align="center">8</td>
<td align="center">1</td>
<td align="center">10</td>
</tr>
<tr class="odd">
<td align="center">160</td>
<td align="center">120</td>
<td align="center">5</td>
<td align="center">9</td>
<td align="center">1</td>
<td align="center">2</td>
</tr>
<tr class="even">
<td align="center">118.6</td>
<td align="center">120</td>
<td align="center">5</td>
<td align="center">10</td>
<td align="center">1</td>
<td align="center">2</td>
</tr>
<tr class="odd">
<td align="center">284.3</td>
<td align="center">120</td>
<td align="center">5</td>
<td align="center">11</td>
<td align="center">1</td>
<td align="center">2</td>
</tr>
<tr class="even">
<td align="center">160</td>
<td align="center">78.55</td>
<td align="center">5</td>
<td align="center">12</td>
<td align="center">1</td>
<td align="center">2</td>
</tr>
<tr class="odd">
<td align="center">160</td>
<td align="center">244.3</td>
<td align="center">5</td>
<td align="center">13</td>
<td align="center">1</td>
<td align="center">2</td>
</tr>
<tr class="even">
<td align="center">118.6</td>
<td align="center">244.3</td>
<td align="center">5</td>
<td align="center">14</td>
<td align="center">1</td>
<td align="center">2</td>
</tr>
<tr class="odd">
<td align="center">242.9</td>
<td align="center">-45.78</td>
<td align="center">5</td>
<td align="center">15</td>
<td align="center">1</td>
<td align="center">2</td>
</tr>
</tbody>
</table>
<pre class="r"><code>ggplot(df, aes(x=u, y=v)) + #geom_point(color=rownames(df)) +
  geom_text(aes(label=id, color=id)) + #,size=dsize
  scale_y_reverse() +
  ggtitle(&#39;Note that image range is (0,0)..(320,240), and point ke(n) = ke(n+7) cuma beda z&#39;)</code></pre>
<p><img src="3dreconstruction_files/figure-html/unnamed-chunk-7-1.png" title="" alt="" width="672" /></p>
<p>Experimen apabila Rt diganti sedikit:</p>
<pre class="r"><code>t &lt;- c(1, 0, 0)
names(t) &lt;- c(&#39;x&#39;, &#39;y&#39;, &#39;z&#39;)
pander(t)</code></pre>
<p><em>1</em>, <em>0</em> and <em>0</em></p>
<pre class="r"><code>Rt &lt;- matrix(c(cos(theta), -sin(theta), 0, t[&#39;x&#39;],
               sin(theta),  cos(theta), 0, t[&#39;y&#39;],
               0,           0,          1, t[&#39;z&#39;]),
             ncol=4, byrow=TRUE)
pander(Rt)</code></pre>
<table>
<colgroup>
<col width="2%" />
<col width="2%" />
<col width="2%" />
<col width="2%" />
</colgroup>
<tbody>
<tr class="odd">
<td align="left">1</td>
<td align="left">0</td>
<td align="left">0</td>
<td align="left">1</td>
</tr>
<tr class="even">
<td align="left">0</td>
<td align="left">1</td>
<td align="left">0</td>
<td align="left">0</td>
</tr>
<tr class="odd">
<td align="left">0</td>
<td align="left">0</td>
<td align="left">1</td>
<td align="left">0</td>
</tr>
</tbody>
</table>
<pre class="r"><code># ramean
sUV &lt;- t(CM %*% Rt %*% t(XYZ))
colnames(sUV) &lt;- c(&#39;su&#39;, &#39;sv&#39;, &#39;s&#39;)
#sUV
UV &lt;- matrix(ncol = 3, nrow = nrow(sUV))
colnames(UV) &lt;- c(&#39;u&#39;, &#39;v&#39;, &#39;s&#39;)
UV[,&#39;u&#39;] &lt;- sUV[,&#39;su&#39;] / sUV[,&#39;s&#39;]
UV[,&#39;v&#39;] &lt;- sUV[,&#39;sv&#39;] / sUV[,&#39;s&#39;]
UV[,&#39;s&#39;] &lt;- sUV[,&#39;s&#39;]
#UV

# plot
library(ggplot2)
df &lt;- data.frame(UV)
pander(df)</code></pre>
<table>
<colgroup>
<col width="8%" />
<col width="9%" />
<col width="5%" />
</colgroup>
<thead>
<tr class="header">
<th align="center">u</th>
<th align="center">v</th>
<th align="center">s</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">20883</td>
<td align="center">120</td>
<td align="center">0.01</td>
</tr>
<tr class="even">
<td align="center">367.2</td>
<td align="center">120</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">160</td>
<td align="center">120</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">988.9</td>
<td align="center">120</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">367.2</td>
<td align="center">-87.23</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">367.2</td>
<td align="center">741.7</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">160</td>
<td align="center">741.7</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">781.7</td>
<td align="center">-708.9</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">201.4</td>
<td align="center">120</td>
<td align="center">5</td>
</tr>
<tr class="even">
<td align="center">160</td>
<td align="center">120</td>
<td align="center">5</td>
</tr>
<tr class="odd">
<td align="center">325.8</td>
<td align="center">120</td>
<td align="center">5</td>
</tr>
<tr class="even">
<td align="center">201.4</td>
<td align="center">78.55</td>
<td align="center">5</td>
</tr>
<tr class="odd">
<td align="center">201.4</td>
<td align="center">244.3</td>
<td align="center">5</td>
</tr>
<tr class="even">
<td align="center">160</td>
<td align="center">244.3</td>
<td align="center">5</td>
</tr>
<tr class="odd">
<td align="center">284.3</td>
<td align="center">-45.78</td>
<td align="center">5</td>
</tr>
</tbody>
</table>
<pre class="r"><code>ggplot(df, aes(x=u, y=v)) + #geom_point(color=rownames(df)) +
  geom_text(label=rownames(df), color=rownames(df)) +
  scale_y_reverse() +
  ggtitle(&#39;Note that image range is (0,0)..(320,240), and point ke(n) = ke(n+7) cuma beda z&#39;)</code></pre>
<p><img src="3dreconstruction_files/figure-html/unnamed-chunk-8-1.png" title="" alt="" width="672" /></p>
</div>
<div id="memplot-lantai" class="section level2">
<h2>Memplot ‘lantai’</h2>
<pre class="r"><code># create 100 lattice points (10x10) spanning from X=-2..+2 and Z =0..10, Y constant = -1
XYZ &lt;- matrix(nrow = 100, ncol=4)
colnames(XYZ) &lt;- c(&#39;x&#39;, &#39;y&#39;, &#39;z&#39;, &#39;dummy&#39;)
for (i in 0:9) {
  for (j in 0:9) {
    x &lt;- -2 + i*0.4
    y &lt;- -1
    z &lt;- 0 + j*1
    XYZ[i * 10 + j + 1,] &lt;- c(x, y, z, 1)
  }
}
pander(XYZ)</code></pre>
<table>
<colgroup>
<col width="6%" />
<col width="5%" />
<col width="5%" />
<col width="9%" />
</colgroup>
<thead>
<tr class="header">
<th align="center">x</th>
<th align="center">y</th>
<th align="center">z</th>
<th align="center">dummy</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">-2</td>
<td align="center">-1</td>
<td align="center">0</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">-2</td>
<td align="center">-1</td>
<td align="center">1</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">-2</td>
<td align="center">-1</td>
<td align="center">2</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">-2</td>
<td align="center">-1</td>
<td align="center">3</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">-2</td>
<td align="center">-1</td>
<td align="center">4</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">-2</td>
<td align="center">-1</td>
<td align="center">5</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">-2</td>
<td align="center">-1</td>
<td align="center">6</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">-2</td>
<td align="center">-1</td>
<td align="center">7</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">-2</td>
<td align="center">-1</td>
<td align="center">8</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">-2</td>
<td align="center">-1</td>
<td align="center">9</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">-1.6</td>
<td align="center">-1</td>
<td align="center">0</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">-1.6</td>
<td align="center">-1</td>
<td align="center">1</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">-1.6</td>
<td align="center">-1</td>
<td align="center">2</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">-1.6</td>
<td align="center">-1</td>
<td align="center">3</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">-1.6</td>
<td align="center">-1</td>
<td align="center">4</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">-1.6</td>
<td align="center">-1</td>
<td align="center">5</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">-1.6</td>
<td align="center">-1</td>
<td align="center">6</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">-1.6</td>
<td align="center">-1</td>
<td align="center">7</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">-1.6</td>
<td align="center">-1</td>
<td align="center">8</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">-1.6</td>
<td align="center">-1</td>
<td align="center">9</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">-1.2</td>
<td align="center">-1</td>
<td align="center">0</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">-1.2</td>
<td align="center">-1</td>
<td align="center">1</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">-1.2</td>
<td align="center">-1</td>
<td align="center">2</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">-1.2</td>
<td align="center">-1</td>
<td align="center">3</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">-1.2</td>
<td align="center">-1</td>
<td align="center">4</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">-1.2</td>
<td align="center">-1</td>
<td align="center">5</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">-1.2</td>
<td align="center">-1</td>
<td align="center">6</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">-1.2</td>
<td align="center">-1</td>
<td align="center">7</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">-1.2</td>
<td align="center">-1</td>
<td align="center">8</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">-1.2</td>
<td align="center">-1</td>
<td align="center">9</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">-0.8</td>
<td align="center">-1</td>
<td align="center">0</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">-0.8</td>
<td align="center">-1</td>
<td align="center">1</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">-0.8</td>
<td align="center">-1</td>
<td align="center">2</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">-0.8</td>
<td align="center">-1</td>
<td align="center">3</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">-0.8</td>
<td align="center">-1</td>
<td align="center">4</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">-0.8</td>
<td align="center">-1</td>
<td align="center">5</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">-0.8</td>
<td align="center">-1</td>
<td align="center">6</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">-0.8</td>
<td align="center">-1</td>
<td align="center">7</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">-0.8</td>
<td align="center">-1</td>
<td align="center">8</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">-0.8</td>
<td align="center">-1</td>
<td align="center">9</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">-0.4</td>
<td align="center">-1</td>
<td align="center">0</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">-0.4</td>
<td align="center">-1</td>
<td align="center">1</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">-0.4</td>
<td align="center">-1</td>
<td align="center">2</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">-0.4</td>
<td align="center">-1</td>
<td align="center">3</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">-0.4</td>
<td align="center">-1</td>
<td align="center">4</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">-0.4</td>
<td align="center">-1</td>
<td align="center">5</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">-0.4</td>
<td align="center">-1</td>
<td align="center">6</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">-0.4</td>
<td align="center">-1</td>
<td align="center">7</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">-0.4</td>
<td align="center">-1</td>
<td align="center">8</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">-0.4</td>
<td align="center">-1</td>
<td align="center">9</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">0</td>
<td align="center">-1</td>
<td align="center">0</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">0</td>
<td align="center">-1</td>
<td align="center">1</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">0</td>
<td align="center">-1</td>
<td align="center">2</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">0</td>
<td align="center">-1</td>
<td align="center">3</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">0</td>
<td align="center">-1</td>
<td align="center">4</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">0</td>
<td align="center">-1</td>
<td align="center">5</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">0</td>
<td align="center">-1</td>
<td align="center">6</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">0</td>
<td align="center">-1</td>
<td align="center">7</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">0</td>
<td align="center">-1</td>
<td align="center">8</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">0</td>
<td align="center">-1</td>
<td align="center">9</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">0.4</td>
<td align="center">-1</td>
<td align="center">0</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">0.4</td>
<td align="center">-1</td>
<td align="center">1</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">0.4</td>
<td align="center">-1</td>
<td align="center">2</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">0.4</td>
<td align="center">-1</td>
<td align="center">3</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">0.4</td>
<td align="center">-1</td>
<td align="center">4</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">0.4</td>
<td align="center">-1</td>
<td align="center">5</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">0.4</td>
<td align="center">-1</td>
<td align="center">6</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">0.4</td>
<td align="center">-1</td>
<td align="center">7</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">0.4</td>
<td align="center">-1</td>
<td align="center">8</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">0.4</td>
<td align="center">-1</td>
<td align="center">9</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">0.8</td>
<td align="center">-1</td>
<td align="center">0</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">0.8</td>
<td align="center">-1</td>
<td align="center">1</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">0.8</td>
<td align="center">-1</td>
<td align="center">2</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">0.8</td>
<td align="center">-1</td>
<td align="center">3</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">0.8</td>
<td align="center">-1</td>
<td align="center">4</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">0.8</td>
<td align="center">-1</td>
<td align="center">5</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">0.8</td>
<td align="center">-1</td>
<td align="center">6</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">0.8</td>
<td align="center">-1</td>
<td align="center">7</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">0.8</td>
<td align="center">-1</td>
<td align="center">8</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">0.8</td>
<td align="center">-1</td>
<td align="center">9</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">1.2</td>
<td align="center">-1</td>
<td align="center">0</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">1.2</td>
<td align="center">-1</td>
<td align="center">1</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">1.2</td>
<td align="center">-1</td>
<td align="center">2</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">1.2</td>
<td align="center">-1</td>
<td align="center">3</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">1.2</td>
<td align="center">-1</td>
<td align="center">4</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">1.2</td>
<td align="center">-1</td>
<td align="center">5</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">1.2</td>
<td align="center">-1</td>
<td align="center">6</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">1.2</td>
<td align="center">-1</td>
<td align="center">7</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">1.2</td>
<td align="center">-1</td>
<td align="center">8</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">1.2</td>
<td align="center">-1</td>
<td align="center">9</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">1.6</td>
<td align="center">-1</td>
<td align="center">0</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">1.6</td>
<td align="center">-1</td>
<td align="center">1</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">1.6</td>
<td align="center">-1</td>
<td align="center">2</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">1.6</td>
<td align="center">-1</td>
<td align="center">3</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">1.6</td>
<td align="center">-1</td>
<td align="center">4</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">1.6</td>
<td align="center">-1</td>
<td align="center">5</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">1.6</td>
<td align="center">-1</td>
<td align="center">6</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">1.6</td>
<td align="center">-1</td>
<td align="center">7</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">1.6</td>
<td align="center">-1</td>
<td align="center">8</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">1.6</td>
<td align="center">-1</td>
<td align="center">9</td>
<td align="center">1</td>
</tr>
</tbody>
</table>
<p>Bila ty = 0:</p>
<pre class="r"><code>theta &lt;- 0*pi
t &lt;- c(0, 0, 0)
names(t) &lt;- c(&#39;x&#39;, &#39;y&#39;, &#39;z&#39;)
pander(t)</code></pre>
<p><em>0</em>, <em>0</em> and <em>0</em></p>
<pre class="r"><code>Rt &lt;- matrix(c(cos(theta), -sin(theta), 0, t[&#39;x&#39;],
               sin(theta),  cos(theta), 0, t[&#39;y&#39;],
               0,           0,          1, t[&#39;z&#39;]),
             ncol=4, byrow=TRUE)
pander(Rt)</code></pre>
<table>
<colgroup>
<col width="2%" />
<col width="2%" />
<col width="2%" />
<col width="2%" />
</colgroup>
<tbody>
<tr class="odd">
<td align="left">1</td>
<td align="left">0</td>
<td align="left">0</td>
<td align="left">0</td>
</tr>
<tr class="even">
<td align="left">0</td>
<td align="left">1</td>
<td align="left">0</td>
<td align="left">0</td>
</tr>
<tr class="odd">
<td align="left">0</td>
<td align="left">0</td>
<td align="left">1</td>
<td align="left">0</td>
</tr>
</tbody>
</table>
<pre class="r"><code># ramean
sUV &lt;- t(CM %*% Rt %*% t(XYZ))
colnames(sUV) &lt;- c(&#39;su&#39;, &#39;sv&#39;, &#39;s&#39;)
#sUV
UV &lt;- matrix(ncol = 3, nrow = nrow(sUV))
colnames(UV) &lt;- c(&#39;u&#39;, &#39;v&#39;, &#39;s&#39;)
UV[,&#39;u&#39;] &lt;- sUV[,&#39;su&#39;] / sUV[,&#39;s&#39;]
UV[,&#39;v&#39;] &lt;- sUV[,&#39;sv&#39;] / sUV[,&#39;s&#39;]
UV[,&#39;s&#39;] &lt;- sUV[,&#39;s&#39;]
#UV

# plot
library(ggplot2)
df &lt;- data.frame(UV)
#df
ggplot(df, aes(x=u, y=v)) + #geom_point(color=rownames(df)) +
  geom_point(aes(color=s, size=10-s), alpha=0.8) +
  scale_y_reverse(limits=c(360, 0), breaks=c(0, 120, 240)) + 
  scale_x_continuous(limits=c(0, 480), breaks=c(0, 160, 320)) +
  ggtitle(&#39;2Dimage range is (0,0)..(320,240)&#39;)</code></pre>
<p><img src="3dreconstruction_files/figure-html/unnamed-chunk-10-1.png" title="" alt="" width="672" /></p>
<p>Bila theta = pi/11: (terhadap sumbu z[depan-belakang])</p>
<pre class="r"><code>theta &lt;- pi/11
t &lt;- c(0, 0, 0)
names(t) &lt;- c(&#39;x&#39;, &#39;y&#39;, &#39;z&#39;)
pander(t)</code></pre>
<p><em>0</em>, <em>0</em> and <em>0</em></p>
<pre class="r"><code>Rt &lt;- matrix(c(cos(theta), -sin(theta), 0, t[&#39;x&#39;],
               sin(theta),  cos(theta), 0, t[&#39;y&#39;],
               0,           0,          1, t[&#39;z&#39;]),
             ncol=4, byrow=TRUE)
pander(Rt)</code></pre>
<table>
<colgroup>
<col width="9%" />
<col width="11%" />
<col width="2%" />
<col width="2%" />
</colgroup>
<tbody>
<tr class="odd">
<td align="left">0.9595</td>
<td align="left">-0.2817</td>
<td align="left">0</td>
<td align="left">0</td>
</tr>
<tr class="even">
<td align="left">0.2817</td>
<td align="left">0.9595</td>
<td align="left">0</td>
<td align="left">0</td>
</tr>
<tr class="odd">
<td align="left">0</td>
<td align="left">0</td>
<td align="left">1</td>
<td align="left">0</td>
</tr>
</tbody>
</table>
<pre class="r"><code># ramean
sUV &lt;- t(CM %*% Rt %*% t(XYZ))
colnames(sUV) &lt;- c(&#39;su&#39;, &#39;sv&#39;, &#39;s&#39;)
#sUV
UV &lt;- matrix(ncol = 3, nrow = nrow(sUV))
colnames(UV) &lt;- c(&#39;u&#39;, &#39;v&#39;, &#39;s&#39;)
UV[,&#39;u&#39;] &lt;- sUV[,&#39;su&#39;] / sUV[,&#39;s&#39;]
UV[,&#39;v&#39;] &lt;- sUV[,&#39;sv&#39;] / sUV[,&#39;s&#39;]
UV[,&#39;s&#39;] &lt;- sUV[,&#39;s&#39;]
#UV

# plot
library(ggplot2)
df &lt;- data.frame(UV)
#df
ggplot(df, aes(x=u, y=v)) + #geom_point(color=rownames(df)) +
  geom_point(aes(color=s, size=10-s), alpha=0.8) +
  scale_y_reverse(limits=c(360, 0), breaks=c(0, 120, 240)) + 
  scale_x_continuous(limits=c(0, 480), breaks=c(0, 160, 320)) +
  ggtitle(&#39;2Dimage range is (0,0)..(320,240)&#39;)</code></pre>
<p><img src="3dreconstruction_files/figure-html/unnamed-chunk-11-1.png" title="" alt="" width="672" /></p>
<p>Bila ty = -1: (kamera agak ke atas)</p>
<pre class="r"><code>t &lt;- c(0, -1, 0)
names(t) &lt;- c(&#39;x&#39;, &#39;y&#39;, &#39;z&#39;)
pander(t)</code></pre>
<p><em>0</em>, <em>-1</em> and <em>0</em></p>
<pre class="r"><code>Rt &lt;- matrix(c(cos(theta), -sin(theta), 0, t[&#39;x&#39;],
               sin(theta),  cos(theta), 0, t[&#39;y&#39;],
               0,           0,          1, t[&#39;z&#39;]),
             ncol=4, byrow=TRUE)
pander(Rt)</code></pre>
<table>
<colgroup>
<col width="9%" />
<col width="11%" />
<col width="2%" />
<col width="2%" />
</colgroup>
<tbody>
<tr class="odd">
<td align="left">0.9595</td>
<td align="left">-0.2817</td>
<td align="left">0</td>
<td align="left">0</td>
</tr>
<tr class="even">
<td align="left">0.2817</td>
<td align="left">0.9595</td>
<td align="left">0</td>
<td align="left">-1</td>
</tr>
<tr class="odd">
<td align="left">0</td>
<td align="left">0</td>
<td align="left">1</td>
<td align="left">0</td>
</tr>
</tbody>
</table>
<pre class="r"><code># ramean
sUV &lt;- t(CM %*% Rt %*% t(XYZ))
colnames(sUV) &lt;- c(&#39;su&#39;, &#39;sv&#39;, &#39;s&#39;)
#sUV
UV &lt;- matrix(ncol = 3, nrow = nrow(sUV))
colnames(UV) &lt;- c(&#39;u&#39;, &#39;v&#39;, &#39;s&#39;)
UV[,&#39;u&#39;] &lt;- sUV[,&#39;su&#39;] / sUV[,&#39;s&#39;]
UV[,&#39;v&#39;] &lt;- sUV[,&#39;sv&#39;] / sUV[,&#39;s&#39;]
UV[,&#39;s&#39;] &lt;- sUV[,&#39;s&#39;]
#UV

# plot
library(ggplot2)
df &lt;- data.frame(UV)
#df
ggplot(df, aes(x=u, y=v)) + #geom_point(color=rownames(df)) +
  geom_point(aes(color=s, size=10-s), alpha=0.8) +
  scale_y_reverse(limits=c(700, 0), breaks=c(0, 120, 240)) + 
  scale_x_continuous(limits=c(0, 1100), breaks=c(0, 160, 320)) +
  ggtitle(&#39;2Dimage range is (0,0)..(320,240)&#39;)</code></pre>
<p><img src="3dreconstruction_files/figure-html/unnamed-chunk-12-1.png" title="" alt="" width="672" /></p>
<p>Bila ty = +2: (kamera di bawah lantai)</p>
<pre class="r"><code>t &lt;- c(0, +2, 0)
names(t) &lt;- c(&#39;x&#39;, &#39;y&#39;, &#39;z&#39;)
pander(t)</code></pre>
<p><em>0</em>, <em>2</em> and <em>0</em></p>
<pre class="r"><code>Rt &lt;- matrix(c(cos(theta), -sin(theta), 0, t[&#39;x&#39;],
               sin(theta),  cos(theta), 0, t[&#39;y&#39;],
               0,           0,          1, t[&#39;z&#39;]),
             ncol=4, byrow=TRUE)
pander(Rt)</code></pre>
<table>
<colgroup>
<col width="9%" />
<col width="11%" />
<col width="2%" />
<col width="2%" />
</colgroup>
<tbody>
<tr class="odd">
<td align="left">0.9595</td>
<td align="left">-0.2817</td>
<td align="left">0</td>
<td align="left">0</td>
</tr>
<tr class="even">
<td align="left">0.2817</td>
<td align="left">0.9595</td>
<td align="left">0</td>
<td align="left">2</td>
</tr>
<tr class="odd">
<td align="left">0</td>
<td align="left">0</td>
<td align="left">1</td>
<td align="left">0</td>
</tr>
</tbody>
</table>
<pre class="r"><code># ramean
sUV &lt;- t(CM %*% Rt %*% t(XYZ))
colnames(sUV) &lt;- c(&#39;su&#39;, &#39;sv&#39;, &#39;s&#39;)
#sUV
UV &lt;- matrix(ncol = 3, nrow = nrow(sUV))
colnames(UV) &lt;- c(&#39;u&#39;, &#39;v&#39;, &#39;s&#39;)
UV[,&#39;u&#39;] &lt;- sUV[,&#39;su&#39;] / sUV[,&#39;s&#39;]
UV[,&#39;v&#39;] &lt;- sUV[,&#39;sv&#39;] / sUV[,&#39;s&#39;]
UV[,&#39;s&#39;] &lt;- sUV[,&#39;s&#39;]
#UV

# plot
library(ggplot2)
df &lt;- data.frame(UV)
#df
ggplot(df, aes(x=u, y=v)) + #geom_point(color=rownames(df)) +
  geom_point(aes(color=s, size=10-s), alpha=0.8) +
  scale_y_reverse(limits=c(700, 0), breaks=c(0, 120, 240)) + 
  scale_x_continuous(limits=c(0, 1100), breaks=c(0, 160, 320)) +
  ggtitle(&#39;2Dimage range is (0,0)..(320,240)&#39;)</code></pre>
<p><img src="3dreconstruction_files/figure-html/unnamed-chunk-13-1.png" title="" alt="" width="672" /></p>
</div>
<div id="d-reconstruction-from-2d" class="section level2">
<h2>3D Reconstruction from 2D</h2>
<p>First, we multiply the CM with Rt:</p>
<pre class="r"><code>theta &lt;- 0*pi
t &lt;- c(0, 0, 0)
names(t) &lt;- c(&#39;x&#39;, &#39;y&#39;, &#39;z&#39;)
pander(t)</code></pre>
<p><em>0</em>, <em>0</em> and <em>0</em></p>
<pre class="r"><code>Rt &lt;- matrix(c(cos(theta), -sin(theta), 0, t[&#39;x&#39;],
               sin(theta),  cos(theta), 0, t[&#39;y&#39;],
               0,           0,          1, t[&#39;z&#39;]),
             ncol=4, byrow=TRUE)
colnames(Rt) &lt;- c(&#39;r1&#39;, &#39;r2&#39;, &#39;r3&#39;, &#39;t&#39;)
pander(Rt)</code></pre>
<table>
<colgroup>
<col width="6%" />
<col width="6%" />
<col width="6%" />
<col width="6%" />
</colgroup>
<thead>
<tr class="header">
<th align="center">r1</th>
<th align="center">r2</th>
<th align="center">r3</th>
<th align="center">t</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">1</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">0</td>
</tr>
<tr class="even">
<td align="center">0</td>
<td align="center">1</td>
<td align="center">0</td>
<td align="center">0</td>
</tr>
<tr class="odd">
<td align="center">0</td>
<td align="center">0</td>
<td align="center">1</td>
<td align="center">0</td>
</tr>
</tbody>
</table>
<pre class="r"><code>CMRt &lt;- CM %*% Rt
pander(CMRt)</code></pre>
<table>
<colgroup>
<col width="8%" />
<col width="9%" />
<col width="6%" />
<col width="6%" />
</colgroup>
<thead>
<tr class="header">
<th align="center">r1</th>
<th align="center">r2</th>
<th align="center">r3</th>
<th align="center">t</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">207.2</td>
<td align="center">0</td>
<td align="center">160</td>
<td align="center">0</td>
</tr>
<tr class="even">
<td align="center">0</td>
<td align="center">-207.2</td>
<td align="center">120</td>
<td align="center">0</td>
</tr>
<tr class="odd">
<td align="center">0</td>
<td align="center">0</td>
<td align="center">1</td>
<td align="center">0</td>
</tr>
</tbody>
</table>
<p>Bila diketahui: u, v, dan y dari object, maka:</p>
<pre class="r"><code># xyz yang diinginkan: c(0.8, -1.0, 6.0)
# uv(s) adalah: c(187.6305 154.5382) -&gt; kalau di imagespace, cuma c(188, 154, dummy=1) dan agak nggak akurat
# y adalah: -1
# dy (y object/lantai dikurangi y camera) = 0 - 1 = -1
# s = dy / (y hasil solve)
yObject &lt;- 0 # lantai Lumen: y == 0
yCamera &lt;- 1 # camera 1 meter di atas lantai
dy &lt;- yObject - yCamera
uv &lt;- c(188, 154, 1)
xyz &lt;- solve(qr(CMRt), uv)
names(xyz) &lt;- c(&#39;x&#39;, &#39;y&#39;, &#39;z&#39;)
pander(xyz)</code></pre>
<p><em>0.1351</em>, <em>-0.1641</em>, <em>1</em> and <em>0</em></p>
<pre class="r"><code># s = dy / (y hasil solve)
s &lt;- dy / xyz[&#39;y&#39;]
pander(s)</code></pre>
<p><em>6.095</em></p>
<pre class="r"><code># kalikan hasil solve dengan s, maka didapatkan xyz sebenarnya
# yaitu: c(0.8, -1.0, 6.0) +- galat
xyz &lt;- xyz * s
pander(xyz)</code></pre>
<p><em>0.8235</em>, <em>-1</em>, <em>6.095</em> and <em>0</em></p>
<p>Terus kita ingin mengetahui tinggi dari objek tersebut, bila diketahui x,y,z,u,v dari kaki, lalu v dari ujung kepala.</p>
<pre class="r"><code>uv.head = c(188, 140, 1) # tingginya 14 pixel di camera
xyz.head &lt;- solve(qr(CMRt), uv.head)
names(xyz.head) &lt;- c(&#39;x&#39;, &#39;y&#39;, &#39;z&#39;)
pander(xyz.head)</code></pre>
<p><em>0.1351</em>, <em>-0.09651</em>, <em>1</em> and <em>0</em></p>
<pre class="r"><code># s sudah didapatkan di atas
# kalikan hasil solve dengan s, maka didapatkan xyz sebenarnya
# di mana bs dipastikan bahwa x.head == x.foot, z.head==z.foot
# kalau misalnya ga sama, berarti s-nya salah
# cuma belum dicoba kalau kameranya berotasi...
xyz.head &lt;- xyz.head * s
pander(xyz.head)</code></pre>
<p><em>0.8235</em>, <em>-0.5882</em>, <em>6.095</em> and <em>0</em></p>
<pre class="r"><code>pander(c(xyz.head[&#39;x&#39;] == xyz[&#39;x&#39;], xyz.head[&#39;z&#39;] == xyz[&#39;z&#39;]))</code></pre>
<p>TRUE TRUE</p>
<pre class="r"><code># tinggi orang adalah xyz.head[y] - xyz.foot[y]
person.height &lt;- xyz.head[&#39;y&#39;] - xyz[&#39;y&#39;]
pander(person.height)</code></pre>
<p><em>0.4118</em></p>
<p>dan dengan yang cara yang sama, harusnya ini juga bisa digunakan untuk mengetahui lebar (kiri..kanan) dari objek / batas koordinat menurut sumbu x.</p>
</div>
<div id="implementasi-di-c" class="section level2">
<h2>Implementasi di C++</h2>
<p>Selain fungsi dasar <a href="http://docs.opencv.org/modules/core/doc/basic_structures.html#matrix-expressions">matrix multiplication di OpenCV</a>, yang dibutuhkan adalah:</p>
<ol style="list-style-type: decimal">
<li><code>qr</code>: QR Decomposition of Matrix.</li>
<li><code>solve</code>: Solve a System of Equations</li>
</ol>
<p>Ternyata sudah ada, yaitu <a href="http://docs.opencv.org/modules/core/doc/operations_on_arrays.html?highlight=solve#bool%20solve(InputArray%20src1,%20InputArray%20src2,%20OutputArray%20dst,%20int%20flags)">bool solve(InputArray src1, InputArray src2, OutputArray dst, int flags=DECOMP_LU)Â¶</a></p>
<p>jadi kalo di R:</p>
<pre class="r"><code>xyz &lt;- solve(qr(CMRt), uv)</code></pre>
<p>di C++ jadi:</p>
<pre><code>bool success = solve(CMRt, uv, xyz, DECOMP_QR);</code></pre>
</div>
<div id="pembuktian-model-dari-realita-samsung-galaxy-s4" class="section level2">
<h2>Pembuktian Model dari Realita Samsung Galaxy S4</h2>
<div id="di-mic-lantai-4" class="section level3">
<h3>Di MIC lantai 4</h3>
<ul>
<li>approximate location : -6.890627,107.610220</li>
<li>ubin : 0.4m x 0.4m</li>
<li>ukuran ruangan: lebar (east-west) max : 11 ubin + 0.24m = 4.4m + 0.24m = 4.64m lebar (east-west) min : 0.1m + 10 ubin + 0.24m = 0.1m + 4m + 0.24m = 4.34m panjang (north-south) ruangan : 29 ubin + 0.28m = 11.6m + 0.28m = 11.88m tinggi ~3m</li>
<li>pier: deket pintu=0.52m, scale.z=0.62m, di dalam=0.235m. jarak dari selatan ke tepi pier: 0.28m + 13ubin + 0.13m = 5.61m jarak dari selatan ke center pier: 0.28m + 13ubin + 0.13m + 0.31m = 5.92m</li>
<li>ketebalan tembok jendela = 0.2m ketebalan tembok ke interior = 0.16m</li>
<li>meja: panjang 1m, tinggi 0.755m, lebar 0.6m</li>
</ul>
</div>
<div id="di-kantor-bippo" class="section level3">
<h3>Di kantor Bippo</h3>
<ul>
<li>ukuran ruangan: dz = (11.66667 + 6.9) * 0.3 = 5.57 m, dengan range: -2…+3.57 dx = 12 * 0.3 = 3.6 m, dengan range: -1.4 .. +2.2</li>
<li>Jarak kamera ke tembok (z) = 11.6667 ubin = 11.6667 * 0.3 = 3.5 m</li>
<li>y kamera = 0.6m. Posisi kamera (0, 0.6, 0).</li>
<li>y lantai = 0m</li>
<li>tinggi objek (ubin) = 0.3m</li>
<li>lebar objek (ubin) = 0.3m</li>
<li>rotasi terhadap horizon = awalnya 0 semua, tapi akan di</li>
<li>posisi objek:
<ol style="list-style-type: decimal">
<li>11 petak dari kamera (0, 0, 3.3)</li>
<li>10 petak dari kamera (0, 0, 3.0)</li>
<li>9 petak dari kamera (0, 0, 2.7)</li>
<li>8 petak dari kamera (0, 0, 2.4)</li>
<li>7 petak dari kamera (0, 0, 2.1)</li>
<li>6 petak dari kamera (0, 0, 1.8)</li>
<li>5 petak dari kamera (0, 0, 1.5)</li>
</ol></li>
</ul>
</div>
</div>
<div id="rotasi-3d" class="section level2">
<h2>Rotasi 3D</h2>
<p>Recall pedoman rotasi sebagai berikut:</p>
<ul>
<li>Pitch (<span class="math">\(R_{cx}\)</span>): Looking up and down (0=Straight Ahead, +Up, -Down).</li>
<li>Roll (<span class="math">\(R_{cy}\)</span>): Rotation about axis of screen, 0=Straight, +Clockwise, -CCW.</li>
<li>Yaw (<span class="math">\(R_{cz}\)</span>): Rotating around (running in circles), 0=North, +West, -East. Kalo di Unreal: 0=East, +North, -South.</li>
</ul>
<p>Dari <a href="https://en.wikipedia.org/wiki/Rotation_matrix#Basic_rotations">Rotation matrix: In three dimensions</a>:</p>
<p><span class="math">\[R_cx(\alpha) = \begin{bmatrix}
  1 &amp; 0 &amp; 0 \\
  0 &amp; \cos \alpha &amp; -\sin \alpha \\
  0 &amp; \sin \alpha &amp; \cos \alpha
\end{bmatrix}
R_cy(\beta) = \begin{bmatrix}
  \cos \beta &amp; 0 &amp; \sin \beta \\
  0          &amp; 1 &amp; 0 \\
  -sin \beta &amp; 0 &amp; \cos \beta
\end{bmatrix}
R_cz(\gamma) = \begin{bmatrix}
  \cos \gamma &amp; -\sin \gamma &amp; 0 \\
  \sin \gamma &amp;   cos \gamma &amp; 0 \\
  0           &amp; 0            &amp; 1
\end{bmatrix}
\]</span></p>
<p>Untuk menggabungkan <span class="math">\(R_cx\)</span>, <span class="math">\(R_cy\)</span>, dan <span class="math">\(R_cz\)</span> kayaknya urutannya begini:</p>
<p><span class="math">\[R_c = R_{cz(Î³)} R_{cy(Î²)} R_{cx(Î±)}
\]</span></p>
<p>Perhatikan bahwa tugas <span class="math">\([R|t]\)</span> adalah mentranslasi lalu merotasi titik 3D agar berada dalam koordinat kamera. Setelah didapatkan <span class="math">\(R_c\)</span> yaitu rotasi kamera dan <span class="math">\(t_c\)</span> yaitu translasi kamera, kita bisa mencari <span class="math">\([R|t]\)</span>. Untuk mendapatkan <span class="math">\([R|\mathbf{t}]\)</span> dari posisi kamera <span class="math">\(t_c\)</span> dan rotasi kamera <span class="math">\(R_c\)</span>, <a href="http://ksimek.github.io/2012/08/22/extrinsic/">maka</a>: (<span class="math">\(^T\)</span>: transpose)</p>
<p><span class="math">\[\left[
\begin{array}{c|c}
R &amp; \mathbf{t} \\
\hline
\mathbf{0} &amp; 1 \\
\end{array}
\right]
  = 
\left[
\begin{array}{c|c}
R_c^T &amp; -R_c^{T} t_c \\
\hline
\mathbf{0} &amp; 1 \\
\end{array}
\right]
\]</span></p>
<p>Dari <a href="http://jepsonsblog.blogspot.com/2012/11/rotation-in-3d-using-opencvs.html">Rotation in 3D using OpenCV</a>:</p>
<pre><code>// Rotation matrices around the X, Y, and Z axis
Mat RX = (Mat_&lt;double&gt;(4, 4) &lt;&lt;
          1,          0,           0, 0,
          0, cos(alpha), -sin(alpha), 0,
          0, sin(alpha),  cos(alpha), 0,
          0,          0,           0, 1);
Mat RY = (Mat_&lt;double&gt;(4, 4) &lt;&lt;
          cos(beta), 0, -sin(beta), 0,
          0, 1,          0, 0,
          sin(beta), 0,  cos(beta), 0,
          0, 0,          0, 1);
Mat RZ = (Mat_&lt;double&gt;(4, 4) &lt;&lt;
          cos(gamma), -sin(gamma), 0, 0,
          sin(gamma),  cos(gamma), 0, 0,
          0,          0,           1, 0,
          0,          0,           0, 1);
// Composed rotation matrix with (RX, RY, RZ)
Mat R = RX * RY * RZ;</code></pre>
</div>


</div>

<script>

// add bootstrap table styles to pandoc tables
$(document).ready(function () {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
});

</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
